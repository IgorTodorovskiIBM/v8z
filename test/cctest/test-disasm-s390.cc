// Copyright 2011 the V8 project authors. All rights reserved.
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
//       copyright notice, this list of conditions and the following
//       disclaimer in the documentation and/or other materials provided
//       with the distribution.
//     * Neither the name of Google Inc. nor the names of its
//       contributors may be used to endorse or promote products derived
//       from this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
#include <stdlib.h>

#include "src/v8.h"

#include "src/debug.h"
#include "src/disasm.h"
#include "src/disassembler.h"
#include "src/macro-assembler.h"
#include "test/cctest/cctest.h"

using namespace v8::internal;


bool DisassembleAndCompare(byte* pc, const char* compare_string) {
  disasm::NameConverter converter;
  disasm::Disassembler disasm(converter);
  EmbeddedVector<char, 128> disasm_buffer;

  disasm.InstructionDecode(disasm_buffer, pc);

  if (strcmp(compare_string, disasm_buffer.start()) != 0) {
    fprintf(stderr,
            "\x65\x78\x70\x65\x63\x74\x65\x64\x3a\x20\xa"
            "\x6c\xa2\xa"
            "\x64\x69\x73\x61\x73\x73\x65\x6d\x62\x6c\x65\x64\x3a\x20\xa"
            "\x6c\xa2\xa\xa",
            compare_string, disasm_buffer.start());
    return false;
  }
  return true;
}


// Set up V8 to a state where we can at least run the assembler and
// disassembler. Declare the variables and allocate the data structures used
// in the rest of the macros.
#define SET_UP()                                            \
  CcTest::InitializeVM();                                   \
  Isolate* isolate = Isolate::Current();                    \
  HandleScope scope(isolate);                               \
  byte* buffer = reinterpret_cast<byte*>(malloc(4 * 1024)); \
  Assembler assm(isolate, buffer, 4 * 1024);                \
  bool failure = false;


// This macro assembles one instruction using the preallocated assembler and
// disassembles the generated instruction, comparing the output to the expected
// value. If the comparison fails an error message is printed, but the test
// continues to run until the end.
#define COMPARE(asm_, compare_string)                                        \
  {                                                                          \
    int pc_offset = assm.pc_offset();                                        \
    byte* progcounter = &buffer[pc_offset];                                  \
    assm.asm_;                                                               \
    if (!DisassembleAndCompare(progcounter, compare_string)) failure = true; \
  }

// Force emission of any pending literals into a pool.
#define EMIT_PENDING_LITERALS() assm.CheckConstPool(true, false)


// Verify that all invocations of the COMPARE macro passed successfully.
// Exit with a failure if at least one of the tests failed.
#define VERIFY_RUN()                                                  \
if (failure) {                                                        \
    V8_Fatal(__FILE__, __LINE__, "\x53\x33\x39\x30\x20\x44\x69\x73\x61\x73\x73\x65\x6d\x62\x6c\x65\x72\x20\x74\x65\x73\x74\x73\x20\x66\x61\x69\x6c\x65\x64\x2e\xa"); \
  }

TEST(TwoBytes) {
  SET_UP();

  COMPARE(svc(Operand(7)), "\x30\x61\x30\x37\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x73\x76\x63\x97");
  COMPARE(ar(r3, r10), "\x31\x61\x33\x61\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x61\x72\x9\x72\x33\x2c\x72\x31\x30");
  COMPARE(sr(r8, ip), "\x31\x62\x38\x63\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x73\x72\x9\x72\x38\x2c\x69\x70");
  COMPARE(mr_z(r0, r6), "\x31\x63\x30\x36\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6d\x72\x9\x72\x30\x2c\x72\x36");
  COMPARE(dr(r1, r5), "\x31\x64\x31\x35\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x64\x72\x9\x72\x31\x2c\x72\x35");
  COMPARE(or_z(r4, r2), "\x31\x36\x34\x32\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x9\x72\x34\x2c\x72\x32");
  COMPARE(nr(fp, r9), "\x31\x34\x62\x39\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6e\x72\x9f\x70\x2c\x72\x39");
  COMPARE(xr(r10, ip), "\x31\x37\x61\x63\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x78\x72\x9\x72\x31\x30\x2c\x69\x70");
  COMPARE(lr(r2, r13), "\x31\x38\x32\x64\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6c\x72\x9\x72\x32\x2c\x72\x31\x33");
  COMPARE(cr_z(r9, r3), "\x31\x39\x39\x33\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x63\x72\x9\x72\x39\x2c\x72\x33");
  COMPARE(clr(sp, r4), "\x31\x35\x66\x34\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x72\x9\x73\x70\x2c\x72\x34");
  COMPARE(bcr(eq, r8), "\x30\x37\x38\x38\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x62\x63\x72\x90\x78\x38\x2c\x72\x38");
  COMPARE(ltr(r10, r1), "\x31\x32\x61\x31\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6c\x74\x72\x9\x72\x31\x30\x2c\x72\x31");
  COMPARE(alr(r6, r8), "\x31\x65\x36\x38\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x61\x6c\x72\x9\x72\x36\x2c\x72\x38");
  COMPARE(slr(r3, ip), "\x31\x66\x33\x63\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x72\x9\x72\x33\x2c\x69\x70");
  COMPARE(lnr(r4, r1), "\x31\x31\x34\x31\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6c\x6e\x72\x9\x72\x34\x2c\x72\x31");
  COMPARE(lcr(r0, r3), "\x31\x33\x30\x33\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6c\x63\x72\x9\x72\x30\x2c\x72\x33");
  COMPARE(basr(r14, r7), "\x30\x64\x65\x37\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x62\x61\x73\x72\x9\x72\x31\x34\x2c\x72\x37");
  COMPARE(ldr(d4, d6), "\x32\x38\x34\x36\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6c\x64\x72\x9f\x34\x2c\x66\x36");

  VERIFY_RUN();
}


TEST(FourBytes) {
  SET_UP();

#if V8_TARGET_ARCH_S390X
  COMPARE(aghi(r5, Operand(1)),
          "\x61\x37\x35\x62\x30\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x61\x67\x68\x69\x9\x72\x35\x2c\x31");
  COMPARE(lghi(r6, Operand(8)),
          "\x61\x37\x36\x39\x30\x30\x30\x38\x20\x20\x20\x20\x20\x20\x20\x6c\x67\x68\x69\x9\x72\x36\x2c\x38");
  COMPARE(mghi(r1, Operand(2)),
          "\x61\x37\x31\x64\x30\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x67\x68\x69\x9\x72\x31\x2c\x32");
  COMPARE(cghi(r3, Operand(7)),
          "\x61\x37\x33\x66\x30\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x63\x67\x68\x69\x9\x72\x33\x2c\x37");
#else
  COMPARE(ahi(r3, Operand(9)),
          "\x61\x37\x33\x61\x30\x30\x30\x39\x20\x20\x20\x20\x20\x20\x20\x61\x68\x69\x9\x72\x33\x2c\x39");
  COMPARE(lhi(r7, Operand(0)),
          "\x61\x37\x37\x38\x30\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x6c\x68\x69\x9\x72\x37\x2c\x30");
  COMPARE(mhi(r8, Operand(3)),
          "\x61\x37\x38\x63\x30\x30\x30\x33\x20\x20\x20\x20\x20\x20\x20\x6d\x68\x69\x9\x72\x38\x2c\x33");
  COMPARE(chi(r4, Operand(5)),
          "\x61\x37\x34\x65\x30\x30\x30\x35\x20\x20\x20\x20\x20\x20\x20\x63\x68\x69\x9\x72\x34\x2c\x35");
  COMPARE(a(r13, MemOperand(r8, 70)),
          "\x35\x61\x64\x30\x38\x30\x34\x36\x20\x20\x20\x20\x20\x20\x20\x61\x9\x72\x31\x33\x2c\x37\x30\x28\x72\x38\x29");
  COMPARE(s(r9, MemOperand(sp, 9)),
          "\x35\x62\x39\x30\x66\x30\x30\x39\x20\x20\x20\x20\x20\x20\x20\x73\x9\x72\x39\x2c\x39\x28\x73\x70\x29");
  COMPARE(m(r6, MemOperand(r7, ip, 20)),
          "\x35\x63\x36\x37\x63\x30\x31\x34\x20\x20\x20\x20\x20\x20\x20\x6d\x9\x72\x36\x2c\x32\x30\x28\x72\x37\x2c\x69\x70\x29");
  COMPARE(d(r14, MemOperand(r7, 15)),
          "\x35\x64\x65\x30\x37\x30\x30\x66\x20\x20\x20\x20\x20\x20\x20\x64\x9\x72\x31\x34\x2c\x31\x35\x28\x72\x37\x29");
  COMPARE(o(r7, MemOperand(r3, r2, 10)),
          "\x35\x36\x37\x33\x32\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x6f\x9\x72\x37\x2c\x31\x30\x28\x72\x33\x2c\x72\x32\x29");
  COMPARE(n(r9, MemOperand(r5, sp, 9)),
          "\x35\x34\x39\x35\x66\x30\x30\x39\x20\x20\x20\x20\x20\x20\x20\x6e\x9\x72\x39\x2c\x39\x28\x72\x35\x2c\x73\x70\x29");
  COMPARE(l(r0, MemOperand(r4, fp, 1)),
          "\x35\x38\x30\x34\x62\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6c\x9\x72\x30\x2c\x31\x28\x72\x34\x2c\x66\x70\x29");
  COMPARE(c(r8, MemOperand(r5, r7, 18)),
          "\x35\x39\x38\x35\x37\x30\x31\x32\x20\x20\x20\x20\x20\x20\x20\x63\x9\x72\x38\x2c\x31\x38\x28\x72\x35\x2c\x72\x37\x29");
  COMPARE(al_z(r6, MemOperand(r9, sp, 2000)),
          "\x35\x65\x36\x39\x66\x37\x64\x30\x20\x20\x20\x20\x20\x20\x20\x61\x6c\x9\x72\x36\x2c\x32\x30\x30\x30\x28\x72\x39\x2c\x73\x70\x29");
  COMPARE(sl(r8, MemOperand(r1, 100)),
          "\x35\x66\x38\x30\x31\x30\x36\x34\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x9\x72\x38\x2c\x31\x30\x30\x28\x72\x31\x29");
  COMPARE(la(r5, MemOperand(r9, 9)),
          "\x34\x31\x35\x30\x39\x30\x30\x39\x20\x20\x20\x20\x20\x20\x20\x6c\x61\x9\x72\x35\x2c\x39\x28\x72\x39\x29");
  COMPARE(ch(r0, MemOperand(r3, 0)),
          "\x34\x39\x30\x30\x33\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x63\x68\x9\x72\x30\x2c\x30\x28\x72\x33\x29");
  COMPARE(cl(r1, MemOperand(r8, 5)),
          "\x35\x35\x31\x30\x38\x30\x30\x35\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x9\x72\x31\x2c\x35\x28\x72\x38\x29");
  COMPARE(cli(MemOperand(r9, 64), Operand(5)),
          "\x39\x35\x30\x35\x39\x30\x34\x30\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x69\x96\x34\x28\x72\x39\x29\x2c\x35");
  COMPARE(tm(MemOperand(r0, 8), Operand(7)),
          "\x39\x31\x30\x37\x30\x30\x30\x38\x20\x20\x20\x20\x20\x20\x20\x74\x6d\x98\x28\x72\x30\x29\x2c\x37");
  COMPARE(bct(r1, MemOperand(r9, 15)),
          "\x34\x36\x31\x30\x39\x30\x30\x66\x20\x20\x20\x20\x20\x20\x20\x62\x63\x74\x9\x72\x31\x2c\x31\x35\x28\x72\x39\x29");
  COMPARE(st(r5, MemOperand(r9, r8, 7)),
          "\x35\x30\x35\x39\x38\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x73\x74\x9\x72\x35\x2c\x37\x28\x72\x39\x2c\x72\x38\x29");
  COMPARE(stc(r13, MemOperand(r5, r1, 8)),
          "\x34\x32\x64\x35\x31\x30\x30\x38\x20\x20\x20\x20\x20\x20\x20\x73\x74\x63\x9\x72\x31\x33\x2c\x38\x28\x72\x35\x2c\x72\x31\x29");
  COMPARE(ic_z(r9, MemOperand(r1, 90)),
          "\x34\x33\x39\x30\x31\x30\x35\x61\x20\x20\x20\x20\x20\x20\x20\x69\x63\x9\x72\x39\x2c\x39\x30\x28\x72\x31\x29");
  COMPARE(sth(r5, MemOperand(r9, r0, 87)),
          "\x34\x30\x35\x39\x30\x30\x35\x37\x20\x20\x20\x20\x20\x20\x20\x73\x74\x68\x9\x72\x35\x2c\x38\x37\x28\x72\x39\x2c\x72\x30\x29");
#endif
  COMPARE(iihh(r10, Operand(8)),
          "\x61\x35\x61\x30\x30\x30\x30\x38\x20\x20\x20\x20\x20\x20\x20\x69\x69\x68\x68\x9\x72\x31\x30\x2c\x38");
  COMPARE(iihl(r9, Operand(10)),
          "\x61\x35\x39\x31\x30\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x69\x69\x68\x6c\x9\x72\x39\x2c\x31\x30");
  COMPARE(iilh(r0, Operand(40)),
          "\x61\x35\x30\x32\x30\x30\x32\x38\x20\x20\x20\x20\x20\x20\x20\x69\x69\x6c\x68\x9\x72\x30\x2c\x34\x30");
  COMPARE(iill(r6, Operand(19)),
          "\x61\x35\x36\x33\x30\x30\x31\x33\x20\x20\x20\x20\x20\x20\x20\x69\x69\x6c\x6c\x9\x72\x36\x2c\x31\x39");
  COMPARE(oill(r9, Operand(9)),
          "\x61\x35\x39\x62\x30\x30\x30\x39\x20\x20\x20\x20\x20\x20\x20\x6f\x69\x6c\x6c\x9\x72\x39\x2c\x39");
  COMPARE(tmll(r4, Operand(7)),
          "\x61\x37\x34\x31\x30\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x74\x6d\x6c\x6c\x9\x72\x34\x2c\x37");
  COMPARE(stm(r2, r5, MemOperand(r9, 44)),
          "\x39\x30\x32\x35\x39\x30\x32\x63\x20\x20\x20\x20\x20\x20\x20\x73\x74\x6d\x9\x72\x32\x2c\x72\x35\x2c\x34\x34\x28\x72\x39\x29");
  COMPARE(lm(r8, r0, MemOperand(sp, 88)),
          "\x39\x38\x38\x30\x66\x30\x35\x38\x20\x20\x20\x20\x20\x20\x20\x6c\x6d\x9\x72\x38\x2c\x72\x30\x2c\x38\x38\x28\x73\x70\x29");
  COMPARE(nill(r7, Operand(30)),
          "\x61\x35\x37\x37\x30\x30\x31\x65\x20\x20\x20\x20\x20\x20\x20\x6e\x69\x6c\x6c\x9\x72\x37\x2c\x33\x30");
  COMPARE(nilh(r8, Operand(4)),
          "\x61\x35\x38\x36\x30\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x6e\x69\x6c\x68\x9\x72\x38\x2c\x34");
  COMPARE(ah(r9, MemOperand(r5, r4, 4)),
          "\x34\x61\x39\x35\x34\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x61\x68\x9\x72\x39\x2c\x34\x28\x72\x35\x2c\x72\x34\x29");
  COMPARE(sh(r8, MemOperand(r1, r2, 6)),
          "\x34\x62\x38\x31\x32\x30\x30\x36\x20\x20\x20\x20\x20\x20\x20\x73\x68\x9\x72\x38\x2c\x36\x28\x72\x31\x2c\x72\x32\x29");
  COMPARE(mh(r5, MemOperand(r9, r8, 7)),
          "\x34\x63\x35\x39\x38\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x6d\x68\x9\x72\x35\x2c\x37\x28\x72\x39\x2c\x72\x38\x29");

  VERIFY_RUN();
}


TEST(SixBytes) {
  SET_UP();

#if V8_TARGET_ARCH_S390X
  COMPARE(llihf(ip, Operand(90000)),
          "\x63\x30\x63\x65\x30\x30\x30\x31\x35\x66\x39\x30\x20\x20\x20\x6c\x6c\x69\x68\x66\x9\x69\x70\x2c\x39\x30\x30\x30\x30");
  COMPARE(agsi(MemOperand(r9, 1000), Operand(70)),
          "\x65\x62\x34\x36\x39\x33\x65\x38\x30\x30\x37\x61\x20\x20\x20\x61\x67\x73\x69\x91\x30\x30\x30\x28\x72\x39\x29\x2c\x37\x30");
  COMPARE(clgfi(r7, Operand(80)),
          "\x63\x32\x37\x65\x30\x30\x30\x30\x30\x30\x35\x30\x20\x20\x20\x63\x6c\x67\x66\x69\x9\x72\x37\x2c\x38\x30");
  COMPARE(cgfi(r8, Operand(10)),
          "\x63\x32\x38\x63\x30\x30\x30\x30\x30\x30\x30\x61\x20\x20\x20\x63\x67\x66\x69\x9\x72\x38\x2c\x31\x30");
  COMPARE(xihf(fp, Operand(8)),
          "\x63\x30\x62\x36\x30\x30\x30\x30\x30\x30\x30\x38\x20\x20\x20\x78\x69\x68\x66\x9f\x70\x2c\x38");
  COMPARE(sllg(r0, r1, r2),
          "\x65\x62\x30\x31\x32\x30\x30\x30\x30\x30\x30\x64\x20\x20\x20\x73\x6c\x6c\x67\x9\x72\x30\x2c\x72\x31\x2c\x30\x28\x72\x32\x29");
  COMPARE(sllg(r0, r1, Operand(10)),
          "\x65\x62\x30\x31\x30\x30\x30\x61\x30\x30\x30\x64\x20\x20\x20\x73\x6c\x6c\x67\x9\x72\x30\x2c\x72\x31\x2c\x31\x30\x28\x72\x30\x29");
  COMPARE(srlg(r1, r3, Operand(10)),
          "\x65\x62\x31\x33\x30\x30\x30\x61\x30\x30\x30\x63\x20\x20\x20\x73\x72\x6c\x67\x9\x72\x31\x2c\x72\x33\x2c\x31\x30\x28\x72\x30\x29");
  COMPARE(srlg(r1, r3, r10),
          "\x65\x62\x31\x33\x61\x30\x30\x30\x30\x30\x30\x63\x20\x20\x20\x73\x72\x6c\x67\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x31\x30\x29");
  COMPARE(slag(r1, r3, Operand(2)),
          "\x65\x62\x31\x33\x30\x30\x30\x32\x30\x30\x30\x62\x20\x20\x20\x73\x6c\x61\x67\x9\x72\x31\x2c\x72\x33\x2c\x32\x28\x72\x30\x29");
  COMPARE(slag(r1, r3, r2),
          "\x65\x62\x31\x33\x32\x30\x30\x30\x30\x30\x30\x62\x20\x20\x20\x73\x6c\x61\x67\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x32\x29");
  COMPARE(srag(r1, r3, r2),
          "\x65\x62\x31\x33\x32\x30\x30\x30\x30\x30\x30\x61\x20\x20\x20\x73\x72\x61\x67\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x32\x29");
  COMPARE(srag(r1, r3, Operand(2)),
          "\x65\x62\x31\x33\x30\x30\x30\x32\x30\x30\x30\x61\x20\x20\x20\x73\x72\x61\x67\x9\x72\x31\x2c\x72\x33\x2c\x32\x28\x72\x30\x29");
  COMPARE(risbg(r1, r2, Operand(3), Operand(5), Operand(2), false),
          "\x65\x63\x31\x32\x30\x33\x30\x35\x30\x32\x35\x35\x20\x20\x20\x72\x69\x73\x62\x67\x9\x72\x31\x2c\x72\x32\x2c\x33\x2c\x35\x2c\x32");
  COMPARE(risbgn(r1, r2, Operand(3), Operand(5), Operand(2), false),
          "\x65\x63\x31\x32\x30\x33\x30\x35\x30\x32\x35\x39\x20\x20\x20\x72\x69\x73\x62\x67\x6e\x9\x72\x31\x2c\x72\x32\x2c\x33\x2c\x35\x2c\x32");
  COMPARE(stmg(r3, r4, MemOperand(sp, 10)),
          "\x65\x62\x33\x34\x66\x30\x30\x61\x30\x30\x32\x34\x20\x20\x20\x73\x74\x6d\x67\x9\x72\x33\x2c\x72\x34\x2c\x31\x30\x28\x73\x70\x29");
  COMPARE(ltg(r1, MemOperand(r4, sp, 10)),
          "\x65\x33\x31\x34\x66\x30\x30\x61\x30\x30\x30\x32\x20\x20\x20\x6c\x74\x67\x9\x72\x31\x2c\x31\x30\x28\x72\x34\x2c\x73\x70\x29");
  COMPARE(lgh(r8, MemOperand(r1, 8888)),
          "\x65\x33\x38\x30\x31\x32\x62\x38\x30\x32\x31\x35\x20\x20\x20\x6c\x67\x68\x9\x72\x38\x2c\x38\x38\x38\x38\x28\x72\x31\x29");
  COMPARE(ag(r4, MemOperand(r9, r4, 2046)),
          "\x65\x33\x34\x39\x34\x37\x66\x65\x30\x30\x30\x38\x20\x20\x20\x61\x67\x9\x72\x34\x2c\x32\x30\x34\x36\x28\x72\x39\x2c\x72\x34\x29");
  COMPARE(agf(r1, MemOperand(r3, sp, 9)),
          "\x65\x33\x31\x33\x66\x30\x30\x39\x30\x30\x31\x38\x20\x20\x20\x61\x67\x66\x9\x72\x31\x2c\x39\x28\x72\x33\x2c\x73\x70\x29");
  COMPARE(sg(r9, MemOperand(r5, 15)),
          "\x65\x33\x39\x30\x35\x30\x30\x66\x30\x30\x30\x39\x20\x20\x20\x73\x67\x9\x72\x39\x2c\x31\x35\x28\x72\x35\x29");
  COMPARE(ng(r7, MemOperand(r5, r6, 1000)),
          "\x65\x33\x37\x35\x36\x33\x65\x38\x30\x30\x38\x30\x20\x20\x20\x6e\x67\x9\x72\x37\x2c\x31\x30\x30\x30\x28\x72\x35\x2c\x72\x36\x29");
  COMPARE(og(r2, MemOperand(r8, r0, 1000)),
          "\x65\x33\x32\x38\x30\x33\x65\x38\x30\x30\x38\x31\x20\x20\x20\x6f\x67\x9\x72\x32\x2c\x31\x30\x30\x30\x28\x72\x38\x2c\x72\x30\x29");
  COMPARE(xg(r9, MemOperand(r3, 8888)),
          "\x65\x33\x39\x30\x33\x32\x62\x38\x30\x32\x38\x32\x20\x20\x20\x78\x67\x9\x72\x39\x2c\x38\x38\x38\x38\x28\x72\x33\x29");
  COMPARE(ng(r0, MemOperand(r9, r3, 900)),
          "\x65\x33\x30\x39\x33\x33\x38\x34\x30\x30\x38\x30\x20\x20\x20\x6e\x67\x9\x72\x30\x2c\x39\x30\x30\x28\x72\x39\x2c\x72\x33\x29");
  COMPARE(og(r3, MemOperand(r8, r2, 8888)),
          "\x65\x33\x33\x38\x32\x32\x62\x38\x30\x32\x38\x31\x20\x20\x20\x6f\x67\x9\x72\x33\x2c\x38\x38\x38\x38\x28\x72\x38\x2c\x72\x32\x29");
  COMPARE(xg(r9, MemOperand(r3, 15)),
          "\x65\x33\x39\x30\x33\x30\x30\x66\x30\x30\x38\x32\x20\x20\x20\x78\x67\x9\x72\x39\x2c\x31\x35\x28\x72\x33\x29");
  COMPARE(cg(r0, MemOperand(r5, r4, 4)),
          "\x65\x33\x30\x35\x34\x30\x30\x34\x30\x30\x32\x30\x20\x20\x20\x63\x67\x9\x72\x30\x2c\x34\x28\x72\x35\x2c\x72\x34\x29");
  COMPARE(lg(r1, MemOperand(r7, r8, 90)),
          "\x65\x33\x31\x37\x38\x30\x35\x61\x30\x30\x30\x34\x20\x20\x20\x6c\x67\x9\x72\x31\x2c\x39\x30\x28\x72\x37\x2c\x72\x38\x29");
  COMPARE(lgf(r1, MemOperand(sp, 15)),
          "\x65\x33\x31\x30\x66\x30\x30\x66\x30\x30\x31\x34\x20\x20\x20\x6c\x67\x66\x9\x72\x31\x2c\x31\x35\x28\x73\x70\x29");
  COMPARE(llgf(r0, MemOperand(r3, r4, 8)),
          "\x65\x33\x30\x33\x34\x30\x30\x38\x30\x30\x31\x36\x20\x20\x20\x6c\x6c\x67\x66\x9\x72\x30\x2c\x38\x28\x72\x33\x2c\x72\x34\x29");
  COMPARE(alg(r8, MemOperand(r4, 11)),
          "\x65\x33\x38\x30\x34\x30\x30\x62\x30\x30\x30\x61\x20\x20\x20\x61\x6c\x67\x9\x72\x38\x2c\x31\x31\x28\x72\x34\x29");
  COMPARE(slg(r1, MemOperand(r5, r6, 11)),
          "\x65\x33\x31\x35\x36\x30\x30\x62\x30\x30\x30\x62\x20\x20\x20\x73\x6c\x67\x9\x72\x31\x2c\x31\x31\x28\x72\x35\x2c\x72\x36\x29");
  COMPARE(sgf(r0, MemOperand(r4, r5, 8888)),
          "\x65\x33\x30\x34\x35\x32\x62\x38\x30\x32\x31\x39\x20\x20\x20\x73\x67\x66\x9\x72\x30\x2c\x38\x38\x38\x38\x28\x72\x34\x2c\x72\x35\x29");
  COMPARE(llgh(r4, MemOperand(r1, 8000)),
          "\x65\x33\x34\x30\x31\x66\x34\x30\x30\x31\x39\x31\x20\x20\x20\x6c\x6c\x67\x68\x9\x72\x34\x2c\x38\x30\x30\x30\x28\x72\x31\x29");
  COMPARE(llgc(r0, MemOperand(r4, r5, 30)),
          "\x65\x33\x30\x34\x35\x30\x31\x65\x30\x30\x39\x30\x20\x20\x20\x6c\x6c\x67\x63\x9\x72\x30\x2c\x33\x30\x28\x72\x34\x2c\x72\x35\x29");
  COMPARE(lgb(r9, MemOperand(r8, r7, 10)),
          "\x65\x33\x39\x38\x37\x30\x30\x61\x30\x30\x37\x37\x20\x20\x20\x6c\x67\x62\x9\x72\x39\x2c\x31\x30\x28\x72\x38\x2c\x72\x37\x29");
  COMPARE(stg(r0, MemOperand(r9, 10)),
          "\x65\x33\x30\x30\x39\x30\x30\x61\x30\x30\x32\x34\x20\x20\x20\x73\x74\x67\x9\x72\x30\x2c\x31\x30\x28\x72\x39\x29");
  COMPARE(mvghi(MemOperand(r7, 25), Operand(100)),
          "\x65\x35\x34\x38\x37\x30\x31\x39\x30\x30\x36\x34\x20\x20\x20\x6d\x76\x67\x68\x69\x92\x35\x28\x72\x37\x29\x2c\x31\x30\x30");
  COMPARE(algfi(r1, Operand(34250)),
          "\x63\x32\x31\x61\x30\x30\x30\x30\x38\x35\x63\x61\x20\x20\x20\x61\x6c\x67\x66\x69\x9\x72\x31\x2c\x33\x34\x32\x35\x30");
  COMPARE(slgfi(r1, Operand(87654321)),
          "\x63\x32\x31\x34\x30\x35\x33\x39\x37\x66\x62\x31\x20\x20\x20\x73\x6c\x67\x66\x69\x9\x72\x31\x2c\x38\x37\x36\x35\x34\x33\x32\x31");
  COMPARE(nihf(r2, Operand(8888)),
          "\x63\x30\x32\x61\x30\x30\x30\x30\x32\x32\x62\x38\x20\x20\x20\x6e\x69\x68\x66\x9\x72\x32\x2c\x38\x38\x38\x38");
  COMPARE(oihf(r6, Operand(9000)),
          "\x63\x30\x36\x63\x30\x30\x30\x30\x32\x33\x32\x38\x20\x20\x20\x6f\x69\x68\x66\x9\x72\x36\x2c\x39\x30\x30\x30");
  COMPARE(msgfi(r6, Operand(90000)),
          "\x63\x32\x36\x30\x30\x30\x30\x31\x35\x66\x39\x30\x20\x20\x20\x6d\x73\x67\x66\x69\x9\x72\x36\x2c\x39\x30\x30\x30\x30");
#else
  COMPARE(llilf(r10, Operand(72354)),
          "\x63\x30\x61\x66\x30\x30\x30\x31\x31\x61\x61\x32\x20\x20\x20\x6c\x6c\x69\x6c\x66\x9\x72\x31\x30\x2c\x37\x32\x33\x35\x34");
  COMPARE(iilf(r4, Operand(11)),
          "\x63\x30\x34\x39\x30\x30\x30\x30\x30\x30\x30\x62\x20\x20\x20\x69\x69\x6c\x66\x9\x72\x34\x2c\x31\x31");
  COMPARE(afi(r2, Operand(8000)),
          "\x63\x32\x32\x39\x30\x30\x30\x30\x31\x66\x34\x30\x20\x20\x20\x61\x66\x69\x9\x72\x32\x2c\x38\x30\x30\x30");
  COMPARE(asi(MemOperand(r9, 1000), Operand(70)),
          "\x65\x62\x34\x36\x39\x33\x65\x38\x30\x30\x36\x61\x20\x20\x20\x61\x73\x69\x91\x30\x30\x30\x28\x72\x39\x29\x2c\x37\x30");
  COMPARE(alfi(r1, Operand(90)),
          "\x63\x32\x31\x62\x30\x30\x30\x30\x30\x30\x35\x61\x20\x20\x20\x61\x6c\x66\x69\x9\x72\x31\x2c\x39\x30");
  COMPARE(clfi(r9, Operand(60)),
          "\x63\x32\x39\x66\x30\x30\x30\x30\x30\x30\x33\x63\x20\x20\x20\x63\x6c\x66\x69\x9\x72\x39\x2c\x36\x30");
  COMPARE(cfi(r8, Operand(10)),
          "\x63\x32\x38\x64\x30\x30\x30\x30\x30\x30\x30\x61\x20\x20\x20\x63\x66\x69\x9\x72\x38\x2c\x31\x30");
  COMPARE(xilf(r3, Operand(15)),
          "\x63\x30\x33\x37\x30\x30\x30\x30\x30\x30\x30\x66\x20\x20\x20\x78\x69\x6c\x66\x9\x72\x33\x2c\x31\x35");
  COMPARE(sllk(r6, r7, Operand(10)),
          "\x65\x62\x36\x37\x30\x30\x30\x61\x30\x30\x64\x66\x20\x20\x20\x73\x6c\x6c\x6b\x9\x72\x36\x2c\x72\x37\x2c\x31\x30\x28\x72\x30\x29");
  COMPARE(sllk(r6, r7, r8),
          "\x65\x62\x36\x37\x38\x30\x30\x30\x30\x30\x64\x66\x20\x20\x20\x73\x6c\x6c\x6b\x9\x72\x36\x2c\x72\x37\x2c\x30\x28\x72\x38\x29");
  COMPARE(slak(r1, r3, r2),
          "\x65\x62\x31\x33\x32\x30\x30\x30\x30\x30\x64\x64\x20\x20\x20\x73\x6c\x61\x6b\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x32\x29");
  COMPARE(slak(r1, r3, Operand(2)),
          "\x65\x62\x31\x33\x30\x30\x30\x32\x30\x30\x64\x64\x20\x20\x20\x73\x6c\x61\x6b\x9\x72\x31\x2c\x72\x33\x2c\x32\x28\x72\x30\x29");
  COMPARE(srak(r1, r3, Operand(2)),
          "\x65\x62\x31\x33\x30\x30\x30\x32\x30\x30\x64\x63\x20\x20\x20\x73\x72\x61\x6b\x9\x72\x31\x2c\x72\x33\x2c\x32\x28\x72\x30\x29");
  COMPARE(srak(r1, r3, r2),
          "\x65\x62\x31\x33\x32\x30\x30\x30\x30\x30\x64\x63\x20\x20\x20\x73\x72\x61\x6b\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x32\x29");
  COMPARE(stmy(r3, r4, MemOperand(sp, 10)),
          "\x65\x62\x33\x34\x66\x30\x30\x61\x30\x30\x39\x30\x20\x20\x20\x73\x74\x6d\x79\x9\x72\x33\x2c\x72\x34\x2c\x31\x30\x28\x73\x70\x29");
  COMPARE(lt_z(r1, MemOperand(r4, sp, 10)),
          "\x65\x33\x31\x34\x66\x30\x30\x61\x30\x30\x31\x32\x20\x20\x20\x6c\x74\x9\x72\x31\x2c\x31\x30\x28\x72\x34\x2c\x73\x70\x29");
  COMPARE(ml(r0, MemOperand(r3, r9, 2046)),
          "\x65\x33\x30\x33\x39\x37\x66\x65\x30\x30\x39\x36\x20\x20\x20\x6d\x6c\x9\x72\x30\x2c\x32\x30\x34\x36\x28\x72\x33\x2c\x72\x39\x29");
  COMPARE(ay(r5, MemOperand(r7, 8888)),
          "\x65\x33\x35\x30\x37\x32\x62\x38\x30\x32\x35\x61\x20\x20\x20\x61\x79\x9\x72\x35\x2c\x38\x38\x38\x38\x28\x72\x37\x29");
  COMPARE(sy(r8, MemOperand(r6, r7, 2046)),
          "\x65\x33\x38\x36\x37\x37\x66\x65\x30\x30\x35\x62\x20\x20\x20\x73\x79\x9\x72\x38\x2c\x32\x30\x34\x36\x28\x72\x36\x2c\x72\x37\x29");
  COMPARE(ny(r2, MemOperand(r9, r0, 8888)),
          "\x65\x33\x32\x39\x30\x32\x62\x38\x30\x32\x35\x34\x20\x20\x20\x6e\x79\x9\x72\x32\x2c\x38\x38\x38\x38\x28\x72\x39\x2c\x72\x30\x29");
  COMPARE(oy(r8, MemOperand(r4, 321)),
          "\x65\x33\x38\x30\x34\x31\x34\x31\x30\x30\x35\x36\x20\x20\x20\x6f\x79\x9\x72\x38\x2c\x33\x32\x31\x28\x72\x34\x29");
  COMPARE(xy(r5, MemOperand(r3, r2, 0)),
          "\x65\x33\x35\x33\x32\x30\x30\x30\x30\x30\x35\x37\x20\x20\x20\x78\x79\x9\x72\x35\x2c\x30\x28\x72\x33\x2c\x72\x32\x29");
  COMPARE(cy(r9, MemOperand(r4, 321)),
          "\x65\x33\x39\x30\x34\x31\x34\x31\x30\x30\x35\x39\x20\x20\x20\x63\x79\x9\x72\x39\x2c\x33\x32\x31\x28\x72\x34\x29");
  COMPARE(ahy(r1, MemOperand(r5, r6, 8888)),
          "\x65\x33\x31\x35\x36\x32\x62\x38\x30\x32\x37\x61\x20\x20\x20\x61\x68\x79\x9\x72\x31\x2c\x38\x38\x38\x38\x28\x72\x35\x2c\x72\x36\x29");
  COMPARE(shy(r1, MemOperand(r5, r6, 8888)),
          "\x65\x33\x31\x35\x36\x32\x62\x38\x30\x32\x37\x62\x20\x20\x20\x73\x68\x79\x9\x72\x31\x2c\x38\x38\x38\x38\x28\x72\x35\x2c\x72\x36\x29");
  COMPARE(lb(r7, MemOperand(sp, 15)),
          "\x65\x33\x37\x30\x66\x30\x30\x66\x30\x30\x37\x36\x20\x20\x20\x6c\x62\x9\x72\x37\x2c\x31\x35\x28\x73\x70\x29");
  COMPARE(ly(r0, MemOperand(r1, r2, 321)),
          "\x65\x33\x30\x31\x32\x31\x34\x31\x30\x30\x35\x38\x20\x20\x20\x6c\x79\x9\x72\x30\x2c\x33\x32\x31\x28\x72\x31\x2c\x72\x32\x29");
  COMPARE(aly(r9, MemOperand(r2, r3, 10)),
          "\x65\x33\x39\x32\x33\x30\x30\x61\x30\x30\x35\x65\x20\x20\x20\x61\x6c\x79\x9\x72\x39\x2c\x31\x30\x28\x72\x32\x2c\x72\x33\x29");
  COMPARE(sly(r2, MemOperand(r9, r1, 15)),
          "\x65\x33\x32\x39\x31\x30\x30\x66\x30\x30\x35\x66\x20\x20\x20\x73\x6c\x79\x9\x72\x32\x2c\x31\x35\x28\x72\x39\x2c\x72\x31\x29");
  COMPARE(llh(r4, MemOperand(r1, 10)),
          "\x65\x33\x34\x30\x31\x30\x30\x61\x30\x30\x39\x35\x20\x20\x20\x6c\x6c\x68\x9\x72\x34\x2c\x31\x30\x28\x72\x31\x29");
  COMPARE(llc(r0, MemOperand(r4, r5, 30)),
          "\x65\x33\x30\x34\x35\x30\x31\x65\x30\x30\x39\x34\x20\x20\x20\x6c\x6c\x63\x9\x72\x30\x2c\x33\x30\x28\x72\x34\x2c\x72\x35\x29");
  COMPARE(chy(r9, MemOperand(r8, r7, 30)),
          "\x65\x33\x39\x38\x37\x30\x31\x65\x30\x30\x37\x39\x20\x20\x20\x63\x68\x79\x9\x72\x39\x2c\x33\x30\x28\x72\x38\x2c\x72\x37\x29");
  COMPARE(cly(r8, MemOperand(r5, r4, 14)),
          "\x65\x33\x38\x35\x34\x30\x30\x65\x30\x30\x35\x35\x20\x20\x20\x63\x6c\x79\x9\x72\x38\x2c\x31\x34\x28\x72\x35\x2c\x72\x34\x29");
  COMPARE(sty(r0, MemOperand(r0, 15)),
          "\x65\x33\x30\x30\x30\x30\x30\x66\x30\x30\x35\x30\x20\x20\x20\x73\x74\x79\x9\x72\x30\x2c\x31\x35\x28\x72\x30\x29");
  COMPARE(mvhi(MemOperand(r7, 25), Operand(100)),
          "\x65\x35\x34\x63\x37\x30\x31\x39\x30\x30\x36\x34\x20\x20\x20\x6d\x76\x68\x69\x92\x35\x28\x72\x37\x29\x2c\x31\x30\x30");
  COMPARE(slfi(r4, Operand(100)),
          "\x63\x32\x34\x35\x30\x30\x30\x30\x30\x30\x36\x34\x20\x20\x20\x73\x6c\x66\x69\x9\x72\x34\x2c\x31\x30\x30");
  COMPARE(msfi(r8, Operand(1000)),
          "\x63\x32\x38\x31\x30\x30\x30\x30\x30\x33\x65\x38\x20\x20\x20\x6d\x73\x66\x69\x9\x72\x38\x2c\x31\x30\x30\x30");
#endif
  COMPARE(iihf(r6, Operand(9)),
          "\x63\x30\x36\x38\x30\x30\x30\x30\x30\x30\x30\x39\x20\x20\x20\x69\x69\x68\x66\x9\x72\x36\x2c\x39");
  COMPARE(srlk(r1, r3, r2),
          "\x65\x62\x31\x33\x32\x30\x30\x30\x30\x30\x64\x65\x20\x20\x20\x73\x72\x6c\x6b\x9\x72\x31\x2c\x72\x33\x2c\x30\x28\x72\x32\x29");
  COMPARE(srlk(r1, r3, Operand(2)),
          "\x65\x62\x31\x33\x30\x30\x30\x32\x30\x30\x64\x65\x20\x20\x20\x73\x72\x6c\x6b\x9\x72\x31\x2c\x72\x33\x2c\x32\x28\x72\x30\x29");
  COMPARE(lmy(r9, r10, MemOperand(r8, 100)),
          "\x65\x62\x39\x61\x38\x30\x36\x34\x30\x30\x39\x38\x20\x20\x20\x6c\x6d\x79\x9\x72\x39\x2c\x72\x31\x30\x2c\x31\x30\x30\x28\x72\x38\x29");
  COMPARE(lmg(r7, r8, MemOperand(r9, 100)),
          "\x65\x62\x37\x38\x39\x30\x36\x34\x30\x30\x30\x34\x20\x20\x20\x6c\x6d\x67\x9\x72\x37\x2c\x72\x38\x2c\x31\x30\x30\x28\x72\x39\x29");
  COMPARE(lay(fp, MemOperand(sp, 8000)),
          "\x65\x33\x62\x30\x66\x66\x34\x30\x30\x31\x37\x31\x20\x20\x20\x6c\x61\x79\x9f\x70\x2c\x38\x30\x30\x30\x28\x73\x70\x29");
  COMPARE(cliy(MemOperand(sp, 80), Operand(80)),
          "\x65\x62\x35\x30\x66\x30\x35\x30\x30\x30\x35\x35\x20\x20\x20\x63\x6c\x69\x79\x98\x30\x28\x73\x70\x29\x2c\x38\x30");
  COMPARE(tmy(MemOperand(r0, 20), Operand(10)),
          "\x65\x62\x30\x61\x30\x30\x31\x34\x30\x30\x35\x31\x20\x20\x20\x74\x6d\x79\x92\x30\x28\x72\x30\x29\x2c\x31\x30");
  COMPARE(clg(r9, MemOperand(r6, r7, 19)),
          "\x65\x33\x39\x36\x37\x30\x31\x33\x30\x30\x32\x31\x20\x20\x20\x63\x6c\x67\x9\x72\x39\x2c\x31\x39\x28\x72\x36\x2c\x72\x37\x29");
  COMPARE(bctg(r8, MemOperand(sp, 10)),
          "\x65\x33\x38\x30\x66\x30\x30\x61\x30\x30\x34\x36\x20\x20\x20\x62\x63\x74\x67\x9\x72\x38\x2c\x31\x30\x28\x73\x70\x29");
  COMPARE(icy(r2, MemOperand(r3, 2)),
          "\x65\x33\x32\x30\x33\x30\x30\x32\x30\x30\x37\x33\x20\x20\x20\x69\x63\x79\x9\x72\x32\x2c\x32\x28\x72\x33\x29");
  COMPARE(mvc(MemOperand(r9, 9), MemOperand(r3, 15), 10),
          "\x64\x32\x30\x39\x39\x30\x30\x39\x33\x30\x30\x66\x20\x20\x20\x6d\x76\x63\x99\x28\x39\x2c\x72\x39\x29\x2c\x31\x35\x28\x72\x33\x29");
  COMPARE(nilf(r0, Operand(8000)),
          "\x63\x30\x30\x62\x30\x30\x30\x30\x31\x66\x34\x30\x20\x20\x20\x6e\x69\x6c\x66\x9\x72\x30\x2c\x38\x30\x30\x30");
  COMPARE(oilf(r9, Operand(1000)),
          "\x63\x30\x39\x64\x30\x30\x30\x30\x30\x33\x65\x38\x20\x20\x20\x6f\x69\x6c\x66\x9\x72\x39\x2c\x31\x30\x30\x30");

  VERIFY_RUN();
}
