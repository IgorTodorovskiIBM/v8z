// Copyright 2012 the V8 project authors. All rights reserved.
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
//       copyright notice, this list of conditions and the following
//       disclaimer in the documentation and/or other materials provided
//       with the distribution.
//     * Neither the name of Google Inc. nor the names of its
//       contributors may be used to endorse or promote products derived
//       from this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//

#include <stdlib.h>

#include "src/v8.h"

#include "src/debug.h"
#include "src/disasm.h"
#include "src/disassembler.h"
#include "src/macro-assembler.h"
#include "src/serialize.h"
#include "test/cctest/cctest.h"

using namespace v8::internal;


bool DisassembleAndCompare(byte* pc, const char* compare_string) {
  disasm::NameConverter converter;
  disasm::Disassembler disasm(converter);
  EmbeddedVector<char, 128> disasm_buffer;

  disasm.InstructionDecode(disasm_buffer, pc);

  if (strcmp(compare_string, disasm_buffer.start()) != 0) {
    fprintf(stderr,
            "\x65\x78\x70\x65\x63\x74\x65\x64\x3a\x20\xa"
            "\x6c\xa2\xa"
            "\x64\x69\x73\x61\x73\x73\x65\x6d\x62\x6c\x65\x64\x3a\x20\xa"
            "\x6c\xa2\xa\xa",
            compare_string, disasm_buffer.start());
    return false;
  }
  return true;
}


// Set up V8 to a state where we can at least run the assembler and
// disassembler. Declare the variables and allocate the data structures used
// in the rest of the macros.
#define SET_UP()                                          \
  CcTest::InitializeVM();                                 \
  Isolate* isolate = CcTest::i_isolate();                  \
  HandleScope scope(isolate);                             \
  byte *buffer = reinterpret_cast<byte*>(malloc(4*1024)); \
  Assembler assm(isolate, buffer, 4*1024);                \
  bool failure = false;


// This macro assembles one instruction using the preallocated assembler and
// disassembles the generated instruction, comparing the output to the expected
// value. If the comparison fails an error message is printed, but the test
// continues to run until the end.
#define COMPARE(asm_, compare_string) \
  { \
    int pc_offset = assm.pc_offset(); \
    byte *progcounter = &buffer[pc_offset]; \
    assm.asm_; \
    if (!DisassembleAndCompare(progcounter, compare_string)) failure = true; \
  }


// Verify that all invocations of the COMPARE macro passed successfully.
// Exit with a failure if at least one of the tests failed.
#define VERIFY_RUN() \
if (failure) { \
    V8_Fatal(__FILE__, __LINE__, "\x4d\x49\x50\x53\x20\x44\x69\x73\x61\x73\x73\x65\x6d\x62\x6c\x65\x72\x20\x74\x65\x73\x74\x73\x20\x66\x61\x69\x6c\x65\x64\x2e\xa"); \
  }


TEST(Type0) {
  SET_UP();

  COMPARE(addu(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x31\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(addu(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x31\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x75\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(addu(v0, v1, s0),
          "\x30\x30\x37\x30\x31\x30\x32\x31\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x75\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x73\x30");

  COMPARE(subu(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x33\x20\x20\x20\x20\x20\x20\x20\x73\x75\x62\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(subu(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x33\x20\x20\x20\x20\x20\x20\x20\x73\x75\x62\x75\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(subu(v0, v1, s0),
          "\x30\x30\x37\x30\x31\x30\x32\x33\x20\x20\x20\x20\x20\x20\x20\x73\x75\x62\x75\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x73\x30");

  COMPARE(mult(a0, a1),
          "\x30\x30\x38\x35\x30\x30\x31\x38\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31");
  COMPARE(mult(t2, t3),
          "\x30\x31\x34\x62\x30\x30\x31\x38\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33");
  COMPARE(mult(v0, v1),
          "\x30\x30\x34\x33\x30\x30\x31\x38\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31");

  COMPARE(multu(a0, a1),
          "\x30\x30\x38\x35\x30\x30\x31\x39\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x75\x20\x20\x20\x61\x30\x2c\x20\x61\x31");
  COMPARE(multu(t2, t3),
          "\x30\x31\x34\x62\x30\x30\x31\x39\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x75\x20\x20\x20\x74\x32\x2c\x20\x74\x33");
  COMPARE(multu(v0, v1),
          "\x30\x30\x34\x33\x30\x30\x31\x39\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x74\x75\x20\x20\x20\x76\x30\x2c\x20\x76\x31");

  COMPARE(div(a0, a1),
          "\x30\x30\x38\x35\x30\x30\x31\x61\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31");
  COMPARE(div(t2, t3),
          "\x30\x31\x34\x62\x30\x30\x31\x61\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33");
  COMPARE(div(v0, v1),
          "\x30\x30\x34\x33\x30\x30\x31\x61\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31");

  COMPARE(divu(a0, a1),
          "\x30\x30\x38\x35\x30\x30\x31\x62\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31");
  COMPARE(divu(t2, t3),
          "\x30\x31\x34\x62\x30\x30\x31\x62\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x75\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33");
  COMPARE(divu(v0, v1),
          "\x30\x30\x34\x33\x30\x30\x31\x62\x20\x20\x20\x20\x20\x20\x20\x64\x69\x76\x75\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31");

  if (kArchVariant != kLoongson) {
    COMPARE(mul(a0, a1, a2),
            "\x37\x30\x61\x36\x32\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
    COMPARE(mul(t2, t3, t4),
            "\x37\x31\x36\x63\x35\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
    COMPARE(mul(v0, v1, s0),
            "\x37\x30\x37\x30\x31\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x6c\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x73\x30");
  }

  COMPARE(addiu(a0, a1, 0x0),
          "\x32\x34\x61\x34\x30\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x69\x75\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(addiu(s0, s1, 32767),
          "\x32\x36\x33\x30\x37\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x69\x75\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x33\x32\x37\x36\x37");
  COMPARE(addiu(t2, t3, -32768),
          "\x32\x35\x36\x61\x38\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x69\x75\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x2d\x33\x32\x37\x36\x38");
  COMPARE(addiu(v0, v1, -1),
          "\x32\x34\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x61\x64\x64\x69\x75\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x2d\x31");

  COMPARE(and_(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x34\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(and_(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x34\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(and_(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x34\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(and_(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x34\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

  COMPARE(or_(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x35\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x20\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(or_(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x35\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x20\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(or_(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x35\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x20\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(or_(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x35\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x20\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

  COMPARE(xor_(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x36\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(xor_(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x36\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(xor_(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x36\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(xor_(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x36\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

  COMPARE(nor(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x37\x20\x20\x20\x20\x20\x20\x20\x6e\x6f\x72\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(nor(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x37\x20\x20\x20\x20\x20\x20\x20\x6e\x6f\x72\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(nor(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x37\x20\x20\x20\x20\x20\x20\x20\x6e\x6f\x72\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(nor(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x37\x20\x20\x20\x20\x20\x20\x20\x6e\x6f\x72\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

  COMPARE(andi(a0, a1, 0x1),
          "\x33\x30\x61\x34\x30\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x69\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30\x78\x31");
  COMPARE(andi(v0, v1, 0xffff),
          "\x33\x30\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x61\x6e\x64\x69\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x30\x78\x66\x66\x66\x66");

  COMPARE(ori(a0, a1, 0x1),
          "\x33\x34\x61\x34\x30\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x69\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30\x78\x31");
  COMPARE(ori(v0, v1, 0xffff),
          "\x33\x34\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x6f\x72\x69\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x30\x78\x66\x66\x66\x66");

  COMPARE(xori(a0, a1, 0x1),
          "\x33\x38\x61\x34\x30\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x69\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30\x78\x31");
  COMPARE(xori(v0, v1, 0xffff),
          "\x33\x38\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x78\x6f\x72\x69\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x30\x78\x66\x66\x66\x66");

  COMPARE(lui(a0, 0x1),
          "\x33\x63\x30\x34\x30\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6c\x75\x69\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x30\x78\x31");
  COMPARE(lui(v0, 0xffff),
          "\x33\x63\x30\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x6c\x75\x69\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x30\x78\x66\x66\x66\x66");

  COMPARE(sll(a0, a1, 0),
          "\x30\x30\x30\x35\x32\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(sll(s0, s1, 8),
          "\x30\x30\x31\x31\x38\x32\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x38");
  COMPARE(sll(t2, t3, 24),
          "\x30\x30\x30\x62\x35\x36\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x32\x34");
  COMPARE(sll(v0, v1, 31),
          "\x30\x30\x30\x33\x31\x37\x63\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x33\x31");

  COMPARE(sllv(a0, a1, a2),
          "\x30\x30\x63\x35\x32\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x76\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(sllv(s0, s1, s2),
          "\x30\x32\x35\x31\x38\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x76\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(sllv(t2, t3, t4),
          "\x30\x31\x38\x62\x35\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x76\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(sllv(v0, v1, fp),
          "\x30\x33\x63\x33\x31\x30\x30\x34\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x6c\x76\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x66\x70");

  COMPARE(srl(a0, a1, 0),
          "\x30\x30\x30\x35\x32\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(srl(s0, s1, 8),
          "\x30\x30\x31\x31\x38\x32\x30\x32\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x38");
  COMPARE(srl(t2, t3, 24),
          "\x30\x30\x30\x62\x35\x36\x30\x32\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x32\x34");
  COMPARE(srl(v0, v1, 31),
          "\x30\x30\x30\x33\x31\x37\x63\x32\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x33\x31");

  COMPARE(srlv(a0, a1, a2),
          "\x30\x30\x63\x35\x32\x30\x30\x36\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x76\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(srlv(s0, s1, s2),
          "\x30\x32\x35\x31\x38\x30\x30\x36\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x76\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(srlv(t2, t3, t4),
          "\x30\x31\x38\x62\x35\x30\x30\x36\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x76\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(srlv(v0, v1, fp),
          "\x30\x33\x63\x33\x31\x30\x30\x36\x20\x20\x20\x20\x20\x20\x20\x73\x72\x6c\x76\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x66\x70");

  COMPARE(sra(a0, a1, 0),
          "\x30\x30\x30\x35\x32\x30\x30\x33\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(sra(s0, s1, 8),
          "\x30\x30\x31\x31\x38\x32\x30\x33\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x38");
  COMPARE(sra(t2, t3, 24),
          "\x30\x30\x30\x62\x35\x36\x30\x33\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x32\x34");
  COMPARE(sra(v0, v1, 31),
          "\x30\x30\x30\x33\x31\x37\x63\x33\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x33\x31");

  COMPARE(srav(a0, a1, a2),
          "\x30\x30\x63\x35\x32\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x76\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(srav(s0, s1, s2),
          "\x30\x32\x35\x31\x38\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x76\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(srav(t2, t3, t4),
          "\x30\x31\x38\x62\x35\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x76\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(srav(v0, v1, fp),
          "\x30\x33\x63\x33\x31\x30\x30\x37\x20\x20\x20\x20\x20\x20\x20\x73\x72\x61\x76\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x66\x70");

  if (kArchVariant == kMips32r2) {
    COMPARE(rotr(a0, a1, 0),
            "\x30\x30\x32\x35\x32\x30\x30\x32\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
    COMPARE(rotr(s0, s1, 8),
            "\x30\x30\x33\x31\x38\x32\x30\x32\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x38");
    COMPARE(rotr(t2, t3, 24),
            "\x30\x30\x32\x62\x35\x36\x30\x32\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x32\x34");
    COMPARE(rotr(v0, v1, 31),
            "\x30\x30\x32\x33\x31\x37\x63\x32\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x33\x31");

    COMPARE(rotrv(a0, a1, a2),
            "\x30\x30\x63\x35\x32\x30\x34\x36\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x76\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
    COMPARE(rotrv(s0, s1, s2),
            "\x30\x32\x35\x31\x38\x30\x34\x36\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x76\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
    COMPARE(rotrv(t2, t3, t4),
            "\x30\x31\x38\x62\x35\x30\x34\x36\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x76\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
    COMPARE(rotrv(v0, v1, fp),
            "\x30\x33\x63\x33\x31\x30\x34\x36\x20\x20\x20\x20\x20\x20\x20\x72\x6f\x74\x72\x76\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x66\x70");
  }

  COMPARE(break_(0),
          "\x30\x30\x30\x30\x30\x30\x30\x64\x20\x20\x20\x20\x20\x20\x20\x62\x72\x65\x61\x6b\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30\x30\x30\x20\x28\x30\x29");
  COMPARE(break_(261120),
          "\x30\x30\x66\x66\x30\x30\x30\x64\x20\x20\x20\x20\x20\x20\x20\x62\x72\x65\x61\x6b\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x63\x30\x30\x20\x28\x32\x36\x31\x31\x32\x30\x29");
  COMPARE(break_(1047552),
          "\x30\x33\x66\x66\x30\x30\x30\x64\x20\x20\x20\x20\x20\x20\x20\x62\x72\x65\x61\x6b\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x66\x66\x63\x30\x30\x20\x28\x31\x30\x34\x37\x35\x35\x32\x29");

  COMPARE(tge(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x30\x20\x20\x20\x20\x20\x20\x20\x74\x67\x65\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(tge(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x30\x20\x20\x20\x20\x20\x20\x20\x74\x67\x65\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");
  COMPARE(tgeu(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x31\x20\x20\x20\x20\x20\x20\x20\x74\x67\x65\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(tgeu(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x31\x20\x20\x20\x20\x20\x20\x20\x74\x67\x65\x75\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");
  COMPARE(tlt(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x32\x20\x20\x20\x20\x20\x20\x20\x74\x6c\x74\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(tlt(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x32\x20\x20\x20\x20\x20\x20\x20\x74\x6c\x74\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");
  COMPARE(tltu(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x33\x20\x20\x20\x20\x20\x20\x20\x74\x6c\x74\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(tltu(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x33\x20\x20\x20\x20\x20\x20\x20\x74\x6c\x74\x75\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");
  COMPARE(teq(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x34\x20\x20\x20\x20\x20\x20\x20\x74\x65\x71\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(teq(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x34\x20\x20\x20\x20\x20\x20\x20\x74\x65\x71\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");
  COMPARE(tne(a0, a1, 0),
          "\x30\x30\x38\x35\x30\x30\x33\x36\x20\x20\x20\x20\x20\x20\x20\x74\x6e\x65\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x30\x30\x30");
  COMPARE(tne(s0, s1, 1023),
          "\x30\x32\x31\x31\x66\x66\x66\x36\x20\x20\x20\x20\x20\x20\x20\x74\x6e\x65\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x63\x6f\x64\x65\x3a\x20\x30\x78\x33\x66\x66");

  COMPARE(mfhi(a0),
          "\x30\x30\x30\x30\x32\x30\x31\x30\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x68\x69\x20\x20\x20\x20\x61\x30");
  COMPARE(mfhi(s2),
          "\x30\x30\x30\x30\x39\x30\x31\x30\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x68\x69\x20\x20\x20\x20\x73\x32");
  COMPARE(mfhi(t4),
          "\x30\x30\x30\x30\x36\x30\x31\x30\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x68\x69\x20\x20\x20\x20\x74\x34");
  COMPARE(mfhi(v1),
          "\x30\x30\x30\x30\x31\x38\x31\x30\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x68\x69\x20\x20\x20\x20\x76\x31");
  COMPARE(mflo(a0),
          "\x30\x30\x30\x30\x32\x30\x31\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x6c\x6f\x20\x20\x20\x20\x61\x30");
  COMPARE(mflo(s2),
          "\x30\x30\x30\x30\x39\x30\x31\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x6c\x6f\x20\x20\x20\x20\x73\x32");
  COMPARE(mflo(t4),
          "\x30\x30\x30\x30\x36\x30\x31\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x6c\x6f\x20\x20\x20\x20\x74\x34");
  COMPARE(mflo(v1),
          "\x30\x30\x30\x30\x31\x38\x31\x32\x20\x20\x20\x20\x20\x20\x20\x6d\x66\x6c\x6f\x20\x20\x20\x20\x76\x31");

  COMPARE(slt(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x61\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(slt(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x61\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x20\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(slt(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x61\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x20\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(slt(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x61\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");
  COMPARE(sltu(a0, a1, a2),
          "\x30\x30\x61\x36\x32\x30\x32\x62\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x75\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
  COMPARE(sltu(s0, s1, s2),
          "\x30\x32\x33\x32\x38\x30\x32\x62\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x75\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
  COMPARE(sltu(t2, t3, t4),
          "\x30\x31\x36\x63\x35\x30\x32\x62\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x75\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
  COMPARE(sltu(v0, v1, a2),
          "\x30\x30\x36\x36\x31\x30\x32\x62\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x75\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

  COMPARE(slti(a0, a1, 0),
          "\x32\x38\x61\x34\x30\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(slti(s0, s1, 32767),
          "\x32\x61\x33\x30\x37\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x33\x32\x37\x36\x37");
  COMPARE(slti(t2, t3, -32768),
          "\x32\x39\x36\x61\x38\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x2d\x33\x32\x37\x36\x38");
  COMPARE(slti(v0, v1, -1),
          "\x32\x38\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x2d\x31");
  COMPARE(sltiu(a0, a1, 0),
          "\x32\x63\x61\x34\x30\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x75\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
  COMPARE(sltiu(s0, s1, 32767),
          "\x32\x65\x33\x30\x37\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x75\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x33\x32\x37\x36\x37");
  COMPARE(sltiu(t2, t3, -32768),
          "\x32\x64\x36\x61\x38\x30\x30\x30\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x75\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x2d\x33\x32\x37\x36\x38");
  COMPARE(sltiu(v0, v1, -1),
          "\x32\x63\x36\x32\x66\x66\x66\x66\x20\x20\x20\x20\x20\x20\x20\x73\x6c\x74\x69\x75\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x2d\x31");

  if (kArchVariant != kLoongson) {
    COMPARE(movz(a0, a1, a2),
            "\x30\x30\x61\x36\x32\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x7a\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
    COMPARE(movz(s0, s1, s2),
            "\x30\x32\x33\x32\x38\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x7a\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
    COMPARE(movz(t2, t3, t4),
            "\x30\x31\x36\x63\x35\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x7a\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
    COMPARE(movz(v0, v1, a2),
            "\x30\x30\x36\x36\x31\x30\x30\x61\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x7a\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");
    COMPARE(movn(a0, a1, a2),
            "\x30\x30\x61\x36\x32\x30\x30\x62\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x6e\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x61\x32");
    COMPARE(movn(s0, s1, s2),
            "\x30\x32\x33\x32\x38\x30\x30\x62\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x6e\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x73\x32");
    COMPARE(movn(t2, t3, t4),
            "\x30\x31\x36\x63\x35\x30\x30\x62\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x6e\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x74\x34");
    COMPARE(movn(v0, v1, a2),
            "\x30\x30\x36\x36\x31\x30\x30\x62\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x6e\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x61\x32");

    COMPARE(movt(a0, a1, 1),
            "\x30\x30\x61\x35\x32\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x74\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x31");
    COMPARE(movt(s0, s1, 2),
            "\x30\x32\x32\x39\x38\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x74\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x32");
    COMPARE(movt(t2, t3, 3),
            "\x30\x31\x36\x64\x35\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x74\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x33");
    COMPARE(movt(v0, v1, 7),
            "\x30\x30\x37\x64\x31\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x74\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x37");
    COMPARE(movf(a0, a1, 0),
            "\x30\x30\x61\x30\x32\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x66\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x30");
    COMPARE(movf(s0, s1, 4),
            "\x30\x32\x33\x30\x38\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x66\x20\x20\x20\x20\x73\x30\x2c\x20\x73\x31\x2c\x20\x34");
    COMPARE(movf(t2, t3, 5),
            "\x30\x31\x37\x34\x35\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x66\x20\x20\x20\x20\x74\x32\x2c\x20\x74\x33\x2c\x20\x35");
    COMPARE(movf(v0, v1, 6),
            "\x30\x30\x37\x38\x31\x30\x30\x31\x20\x20\x20\x20\x20\x20\x20\x6d\x6f\x76\x66\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x36");

    COMPARE(clz(a0, a1),
            "\x37\x30\x61\x34\x32\x30\x32\x30\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x7a\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31");
    COMPARE(clz(s6, s7),
            "\x37\x32\x66\x36\x62\x30\x32\x30\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x7a\x20\x20\x20\x20\x20\x73\x36\x2c\x20\x73\x37");
    COMPARE(clz(v0, v1),
            "\x37\x30\x36\x32\x31\x30\x32\x30\x20\x20\x20\x20\x20\x20\x20\x63\x6c\x7a\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31");
  }

  if (kArchVariant == kMips32r2) {
    COMPARE(ins_(a0, a1, 31, 1),
            "\x37\x63\x61\x34\x66\x66\x63\x34\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x73\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x33\x31\x2c\x20\x31");
    COMPARE(ins_(s6, s7, 30, 2),
            "\x37\x65\x66\x36\x66\x66\x38\x34\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x73\x20\x20\x20\x20\x20\x73\x36\x2c\x20\x73\x37\x2c\x20\x33\x30\x2c\x20\x32");
    COMPARE(ins_(v0, v1, 0, 32),
            "\x37\x63\x36\x32\x66\x38\x30\x34\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x73\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x30\x2c\x20\x33\x32");
    COMPARE(ext_(a0, a1, 31, 1),
            "\x37\x63\x61\x34\x30\x37\x63\x30\x20\x20\x20\x20\x20\x20\x20\x65\x78\x74\x20\x20\x20\x20\x20\x61\x30\x2c\x20\x61\x31\x2c\x20\x33\x31\x2c\x20\x31");
    COMPARE(ext_(s6, s7, 30, 2),
            "\x37\x65\x66\x36\x30\x66\x38\x30\x20\x20\x20\x20\x20\x20\x20\x65\x78\x74\x20\x20\x20\x20\x20\x73\x36\x2c\x20\x73\x37\x2c\x20\x33\x30\x2c\x20\x32");
    COMPARE(ext_(v0, v1, 0, 32),
            "\x37\x63\x36\x32\x66\x38\x30\x30\x20\x20\x20\x20\x20\x20\x20\x65\x78\x74\x20\x20\x20\x20\x20\x76\x30\x2c\x20\x76\x31\x2c\x20\x30\x2c\x20\x33\x32");
  }

  VERIFY_RUN();
}
